import { useState, useEffect } from "react";
import { BrowserRouter, Routes, Route, useParams, useNavigate } from "react-router-dom";

function normalizeInstagram(input) {
  if (!input) return "";
  return input.replace(/^@/, "").trim();
}

function Home() {
  const [name, setName] = useState("");
  const [intro, setIntro] = useState("");
  const [instagram, setInstagram] = useState("");
  const [image, setImage] = useState(null);

  const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onloadend = () => {
      setImage(reader.result);
    };
    reader.readAsDataURL(file);
  };("");
  const navigate = useNavigate();

  const handleSubmit = () => {
    if (!name) return;
    const id = crypto.randomUUID();
    const profile = { id, name, intro, instagram: normalizeInstagram(instagram), image };
    const profiles = JSON.parse(localStorage.getItem("profiles") || "[]");
    profiles.push(profile);
    localStorage.setItem("profiles", JSON.stringify(profiles));
    navigate(`/profile/${id}`);
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 p-4">
      <div className="relative bg-white/90 backdrop-blur p-6 rounded-[2.5rem] shadow-xl w-full max-w-md">
        
        <h1 className="text-center text-3xl font-extrabold text-purple-500 mb-4 mt-4">My Profile</h1>
        <div className="flex justify-center mb-4">
          <label className="cursor-pointer">
            <div className="w-24 h-24 rounded-full bg-gradient-to-br from-pink-200 to-purple-200 flex items-center justify-center overflow-hidden border-4 border-white shadow">
              {image ? (
                <img src={image} alt="preview" className="w-full h-full object-cover" />
              ) : (
                <span className="text-purple-400 text-sm">ÁîªÂÉè</span>
              )}
            </div>
            <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" />
          </label>
        </div>
        <input
          className="border-2 border-purple-200 p-3 w-full mb-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-300"
          placeholder="„Å™„Åæ„Åà"
          value={name}
          onChange={(e) => setName(e.target.value)}
        />
        <textarea
          className="border-2 border-purple-200 p-3 w-full mb-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-300"
          placeholder="„Åò„Åì„Åó„Çá„ÅÜ„Åã„ÅÑ"
          value={intro}
          onChange={(e) => setIntro(e.target.value)}
        />
        <input
          className="border-2 border-purple-200 p-3 w-full mb-4 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-300"
          placeholder="Instagram ID"
          value={instagram}
          onChange={(e) => setInstagram(e.target.value)}
        />
        <button
          onClick={handleSubmit}
          className="w-full bg-gradient-to-r from-pink-400 to-purple-400 hover:from-pink-500 hover:to-purple-500 text-white py-3 rounded-full font-bold transition"
        >
          ‚ô° „Ç´„Éº„Éâ„Çí„Å§„Åè„Çã ‚ô°
        </button>
      </div>
    </div>
  );
}

function Profile() {
  const { id } = useParams();
  const [profile, setProfile] = useState(null);

  useEffect(() => {
    const profiles = JSON.parse(localStorage.getItem("profiles") || "[]");
    setProfile(profiles.find((p) => p.id === id));
  }, [id]);

  if (!profile) {
    return <div className="p-10">„Éó„É≠„Éï„Ç£„Éº„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>;
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 p-4">
      <div className="bg-white/90 backdrop-blur p-6 rounded-[2.5rem] shadow-xl w-full max-w-md">
        {profile.image && (
          <div className="flex justify-center mb-4">
            <img
              src={profile.image}
              alt="icon"
              className="w-28 h-28 rounded-full object-cover border-4 border-white shadow"
            />
          </div>
        )}
        <div className="text-center mb-4">
          <div className="text-xs text-purple-400 tracking-widest">MY PROFILE</div>
          <h1 className="text-3xl font-extrabold text-purple-500 mt-1">{profile.name}</h1>
        </div>
        <div className="bg-gradient-to-br from-pink-50 to-purple-50 rounded-2xl p-4 mb-4">
          <p className="text-gray-700 whitespace-pre-wrap text-sm leading-relaxed">{profile.intro}</p>
        </div>
        {profile.instagram && (
          <a
            href={`https://www.instagram.com/${profile.instagram}`}
            target="_blank"
            rel="noopener noreferrer"
            className="block text-center bg-gradient-to-r from-pink-400 to-purple-400 text-white py-3 rounded-full font-bold"
          >
            üì∑ @{profile.instagram}
          </a>
        )}
      </div>
    </div>
  );
}

export default function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/profile/:id" element={<Profile />} />
      </Routes>
    </BrowserRouter>
  );
}
